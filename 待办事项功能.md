# å¾…åŠäº‹é¡¹ API æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

å¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿ RESTful API æ¥å£æ–‡æ¡£ï¼Œç”¨äºå‰åç«¯æ•°æ®äº¤äº’ã€‚

**åŸºç¡€ä¿¡æ¯**
- **Base URL**: `http://localhost:5000/api`
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

---

## ğŸ”Œ æ¥å£åˆ—è¡¨

### 1. è·å–ä»»åŠ¡åˆ—è¡¨

è·å–æ‰€æœ‰å¾…åŠäº‹é¡¹ä»»åŠ¡ã€‚

**åŸºæœ¬ä¿¡æ¯**
```
GET /tasks
```

**è¯·æ±‚å¤´**
```
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**
æ— 

**æˆåŠŸå“åº”**

çŠ¶æ€ç : `200 OK`

```json
{
  "msg": "success",
  "data": [
    {
      "id": 1,
      "title": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
      "description": "ç¼–å†™ API æ¥å£æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜",
      "status": "pending",
      "create_time": "2025-11-24T10:30:00.123456",
      "update_time": "2025-11-24T10:30:00.123456"
    },
    {
      "id": 2,
      "title": "å­¦ä¹  Flask",
      "description": "æ·±å…¥å­¦ä¹  Flask æ¡†æ¶",
      "status": "pending",
      "create_time": "2025-11-24T10:35:00.123456",
      "update_time": "2025-11-24T10:35:00.123456"
    }
  ]
}
```

**å“åº”å­—æ®µè¯´æ˜**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| msg | string | å“åº”æ¶ˆæ¯ï¼ŒæˆåŠŸä¸º "success" |
| data | array | ä»»åŠ¡åˆ—è¡¨æ•°ç»„ |
| data[].id | integer | ä»»åŠ¡å”¯ä¸€æ ‡è¯† |
| data[].title | string | ä»»åŠ¡æ ‡é¢˜ |
| data[].description | string | ä»»åŠ¡æè¿°ï¼Œå¯èƒ½ä¸º null |
| data[].status | string | ä»»åŠ¡çŠ¶æ€ï¼špendingï¼ˆå¾…å®Œæˆï¼‰ã€completedï¼ˆå·²å®Œæˆï¼‰ |
| data[].create_time | string | åˆ›å»ºæ—¶é—´ï¼ˆISO 8601 æ ¼å¼ï¼‰ |
| data[].update_time | string | æ›´æ–°æ—¶é—´ï¼ˆISO 8601 æ ¼å¼ï¼‰ |

**å‰ç«¯ç¤ºä¾‹ä»£ç **

```javascript
// ä½¿ç”¨ fetch
fetch('http://localhost:5000/api/tasks')
  .then(response => response.json())
  .then(data => {
    console.log('ä»»åŠ¡åˆ—è¡¨:', data.data);
  })
  .catch(error => console.error('é”™è¯¯:', error));

// ä½¿ç”¨ axios
axios.get('http://localhost:5000/api/tasks')
  .then(response => {
    console.log('ä»»åŠ¡åˆ—è¡¨:', response.data.data);
  })
  .catch(error => console.error('é”™è¯¯:', error));
```

---

### 2. åˆ›å»ºæ–°ä»»åŠ¡

æ·»åŠ ä¸€ä¸ªæ–°çš„å¾…åŠäº‹é¡¹ä»»åŠ¡ã€‚

**åŸºæœ¬ä¿¡æ¯**
```
POST /tasks
```

**è¯·æ±‚å¤´**
```
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| title | string | âœ… æ˜¯ | ä»»åŠ¡æ ‡é¢˜ï¼Œä¸èƒ½ä¸ºç©º |
| description | string | âŒ å¦ | ä»»åŠ¡æè¿°ï¼Œå¯é€‰ |

**è¯·æ±‚ç¤ºä¾‹**

```json
{
  "title": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
  "description": "ç¼–å†™ API æ¥å£æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜"
}
```

**æˆåŠŸå“åº”**

çŠ¶æ€ç : `201 Created`

```json
{
  "msg": "success",
  "data": {
    "id": 1,
    "title": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
    "description": "ç¼–å†™ API æ¥å£æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜",
    "status": "pending",
    "create_time": "2025-11-24T10:30:00.123456"
  }
}
```

**å“åº”å­—æ®µè¯´æ˜**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| msg | string | å“åº”æ¶ˆæ¯ï¼ŒæˆåŠŸä¸º "success" |
| data | object | æ–°åˆ›å»ºçš„ä»»åŠ¡å¯¹è±¡ |
| data.id | integer | ä»»åŠ¡å”¯ä¸€æ ‡è¯† |
| data.title | string | ä»»åŠ¡æ ‡é¢˜ |
| data.description | string | ä»»åŠ¡æè¿° |
| data.status | string | ä»»åŠ¡çŠ¶æ€ï¼Œé»˜è®¤ä¸º "pending" |
| data.create_time | string | åˆ›å»ºæ—¶é—´ï¼ˆISO 8601 æ ¼å¼ï¼‰ |

**å¤±è´¥å“åº”**

çŠ¶æ€ç : `400 Bad Request`

```json
{
  "msg": "invalid",
  "errors": ["æ ‡é¢˜ä¸èƒ½ä¸ºç©º"]
}
```

**å‰ç«¯ç¤ºä¾‹ä»£ç **

```javascript
// ä½¿ç”¨ fetch
const taskData = {
  title: 'å®Œæˆé¡¹ç›®æ–‡æ¡£',
  description: 'ç¼–å†™ API æ¥å£æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜'
};

fetch('http://localhost:5000/api/tasks', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(taskData)
})
  .then(response => response.json())
  .then(data => {
    if (data.msg === 'success') {
      console.log('ä»»åŠ¡åˆ›å»ºæˆåŠŸ:', data.data);
    } else {
      console.error('åˆ›å»ºå¤±è´¥:', data.errors);
    }
  })
  .catch(error => console.error('é”™è¯¯:', error));

// ä½¿ç”¨ axios
axios.post('http://localhost:5000/api/tasks', {
  title: 'å®Œæˆé¡¹ç›®æ–‡æ¡£',
  description: 'ç¼–å†™ API æ¥å£æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜'
})
  .then(response => {
    console.log('ä»»åŠ¡åˆ›å»ºæˆåŠŸ:', response.data.data);
  })
  .catch(error => {
    if (error.response) {
      console.error('åˆ›å»ºå¤±è´¥:', error.response.data.errors);
    }
  });
```

---

### 3. åˆ é™¤ä»»åŠ¡

åˆ é™¤æŒ‡å®šçš„å¾…åŠäº‹é¡¹ä»»åŠ¡ã€‚

**åŸºæœ¬ä¿¡æ¯**
```
DELETE /tasks/{id}
```

**è¯·æ±‚å¤´**
```
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | integer | âœ… æ˜¯ | è¦åˆ é™¤çš„ä»»åŠ¡ ID |

**è¯·æ±‚ç¤ºä¾‹**
```
DELETE /tasks/1
```

**æˆåŠŸå“åº”**

çŠ¶æ€ç : `200 OK`

```json
{
  "msg": "success"
}
```

**å¤±è´¥å“åº”**

çŠ¶æ€ç : `404 Not Found`

```json
{
  "msg": "error",
  "errors": ["ä»»åŠ¡ä¸å­˜åœ¨"]
}
```

**å‰ç«¯ç¤ºä¾‹ä»£ç **

```javascript
// ä½¿ç”¨ fetch
const taskId = 1;

fetch(`http://localhost:5000/api/tasks/${taskId}`, {
  method: 'DELETE'
})
  .then(response => response.json())
  .then(data => {
    if (data.msg === 'success') {
      console.log('ä»»åŠ¡åˆ é™¤æˆåŠŸ');
    } else {
      console.error('åˆ é™¤å¤±è´¥:', data.errors);
    }
  })
  .catch(error => console.error('é”™è¯¯:', error));

// ä½¿ç”¨ axios
axios.delete(`http://localhost:5000/api/tasks/${taskId}`)
  .then(response => {
    console.log('ä»»åŠ¡åˆ é™¤æˆåŠŸ');
  })
  .catch(error => {
    if (error.response && error.response.status === 404) {
      console.error('ä»»åŠ¡ä¸å­˜åœ¨');
    }
  });
```

---

## ğŸ¯ å®Œæ•´å‰ç«¯ç¤ºä¾‹

### Vue 3 ç¤ºä¾‹

```vue
<template>
  <div class="task-manager">
    <h1>å¾…åŠäº‹é¡¹ç®¡ç†</h1>
    
    <!-- æ·»åŠ ä»»åŠ¡è¡¨å• -->
    <div class="add-task-form">
      <input v-model="newTask.title" placeholder="ä»»åŠ¡æ ‡é¢˜" />
      <input v-model="newTask.description" placeholder="ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰" />
      <button @click="addTask">æ·»åŠ ä»»åŠ¡</button>
    </div>
    
    <!-- ä»»åŠ¡åˆ—è¡¨ -->
    <div class="task-list">
      <div v-for="task in tasks" :key="task.id" class="task-item">
        <h3>{{ task.title }}</h3>
        <p>{{ task.description }}</p>
        <small>åˆ›å»ºæ—¶é—´: {{ formatDate(task.create_time) }}</small>
        <button @click="deleteTask(task.id)">åˆ é™¤</button>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import axios from 'axios';

const API_BASE = 'http://localhost:5000/api';
const tasks = ref([]);
const newTask = ref({ title: '', description: '' });

// è·å–ä»»åŠ¡åˆ—è¡¨
const fetchTasks = async () => {
  try {
    const response = await axios.get(`${API_BASE}/tasks`);
    tasks.value = response.data.data;
  } catch (error) {
    console.error('è·å–ä»»åŠ¡åˆ—è¡¨å¤±è´¥:', error);
  }
};

// æ·»åŠ ä»»åŠ¡
const addTask = async () => {
  if (!newTask.value.title.trim()) {
    alert('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜');
    return;
  }
  
  try {
    const response = await axios.post(`${API_BASE}/tasks`, newTask.value);
    tasks.value.unshift(response.data.data);
    newTask.value = { title: '', description: '' };
  } catch (error) {
    console.error('æ·»åŠ ä»»åŠ¡å¤±è´¥:', error);
    alert('æ·»åŠ ä»»åŠ¡å¤±è´¥');
  }
};

// åˆ é™¤ä»»åŠ¡
const deleteTask = async (id) => {
  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) return;
  
  try {
    await axios.delete(`${API_BASE}/tasks/${id}`);
    tasks.value = tasks.value.filter(task => task.id !== id);
  } catch (error) {
    console.error('åˆ é™¤ä»»åŠ¡å¤±è´¥:', error);
    alert('åˆ é™¤ä»»åŠ¡å¤±è´¥');
  }
};

// æ ¼å¼åŒ–æ—¥æœŸ
const formatDate = (dateStr) => {
  return new Date(dateStr).toLocaleString('zh-CN');
};

onMounted(() => {
  fetchTasks();
});
</script>
```

### React ç¤ºä¾‹

```jsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';

const API_BASE = 'http://localhost:5000/api';

function TaskManager() {
  const [tasks, setTasks] = useState([]);
  const [newTask, setNewTask] = useState({ title: '', description: '' });

  // è·å–ä»»åŠ¡åˆ—è¡¨
  useEffect(() => {
    fetchTasks();
  }, []);

  const fetchTasks = async () => {
    try {
      const response = await axios.get(`${API_BASE}/tasks`);
      setTasks(response.data.data);
    } catch (error) {
      console.error('è·å–ä»»åŠ¡åˆ—è¡¨å¤±è´¥:', error);
    }
  };

  // æ·»åŠ ä»»åŠ¡
  const addTask = async () => {
    if (!newTask.title.trim()) {
      alert('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜');
      return;
    }

    try {
      const response = await axios.post(`${API_BASE}/tasks`, newTask);
      setTasks([response.data.data, ...tasks]);
      setNewTask({ title: '', description: '' });
    } catch (error) {
      console.error('æ·»åŠ ä»»åŠ¡å¤±è´¥:', error);
      alert('æ·»åŠ ä»»åŠ¡å¤±è´¥');
    }
  };

  // åˆ é™¤ä»»åŠ¡
  const deleteTask = async (id) => {
    if (!window.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) return;

    try {
      await axios.delete(`${API_BASE}/tasks/${id}`);
      setTasks(tasks.filter(task => task.id !== id));
    } catch (error) {
      console.error('åˆ é™¤ä»»åŠ¡å¤±è´¥:', error);
      alert('åˆ é™¤ä»»åŠ¡å¤±è´¥');
    }
  };

  return (
    <div className="task-manager">
      <h1>å¾…åŠäº‹é¡¹ç®¡ç†</h1>
      
      {/* æ·»åŠ ä»»åŠ¡è¡¨å• */}
      <div className="add-task-form">
        <input
          value={newTask.title}
          onChange={(e) => setNewTask({ ...newTask, title: e.target.value })}
          placeholder="ä»»åŠ¡æ ‡é¢˜"
        />
        <input
          value={newTask.description}
          onChange={(e) => setNewTask({ ...newTask, description: e.target.value })}
          placeholder="ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰"
        />
        <button onClick={addTask}>æ·»åŠ ä»»åŠ¡</button>
      </div>
      
      {/* ä»»åŠ¡åˆ—è¡¨ */}
      <div className="task-list">
        {tasks.map(task => (
          <div key={task.id} className="task-item">
            <h3>{task.title}</h3>
            <p>{task.description}</p>
            <small>åˆ›å»ºæ—¶é—´: {new Date(task.create_time).toLocaleString('zh-CN')}</small>
            <button onClick={() => deleteTask(task.id)}>åˆ é™¤</button>
          </div>
        ))}
      </div>
    </div>
  );
}

export default TaskManager;
```

### åŸç”Ÿ JavaScript ç¤ºä¾‹

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å¾…åŠäº‹é¡¹ç®¡ç†</title>
  <style>
    .task-item {
      border: 1px solid #ddd;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
    }
    button {
      margin: 5px;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <h1>å¾…åŠäº‹é¡¹ç®¡ç†</h1>
  
  <div>
    <input id="taskTitle" placeholder="ä»»åŠ¡æ ‡é¢˜" />
    <input id="taskDescription" placeholder="ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰" />
    <button onclick="addTask()">æ·»åŠ ä»»åŠ¡</button>
  </div>
  
  <div id="taskList"></div>

  <script>
    const API_BASE = 'http://localhost:5000/api';

    // è·å–ä»»åŠ¡åˆ—è¡¨
    async function fetchTasks() {
      try {
        const response = await fetch(`${API_BASE}/tasks`);
        const data = await response.json();
        displayTasks(data.data);
      } catch (error) {
        console.error('è·å–ä»»åŠ¡åˆ—è¡¨å¤±è´¥:', error);
      }
    }

    // æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨
    function displayTasks(tasks) {
      const taskList = document.getElementById('taskList');
      taskList.innerHTML = tasks.map(task => `
        <div class="task-item">
          <h3>${task.title}</h3>
          <p>${task.description || 'æ— æè¿°'}</p>
          <small>åˆ›å»ºæ—¶é—´: ${new Date(task.create_time).toLocaleString('zh-CN')}</small>
          <button onclick="deleteTask(${task.id})">åˆ é™¤</button>
        </div>
      `).join('');
    }

    // æ·»åŠ ä»»åŠ¡
    async function addTask() {
      const title = document.getElementById('taskTitle').value;
      const description = document.getElementById('taskDescription').value;

      if (!title.trim()) {
        alert('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/tasks`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, description })
        });
        
        const data = await response.json();
        if (data.msg === 'success') {
          document.getElementById('taskTitle').value = '';
          document.getElementById('taskDescription').value = '';
          fetchTasks();
        }
      } catch (error) {
        console.error('æ·»åŠ ä»»åŠ¡å¤±è´¥:', error);
      }
    }

    // åˆ é™¤ä»»åŠ¡
    async function deleteTask(id) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) return;

      try {
        const response = await fetch(`${API_BASE}/tasks/${id}`, {
          method: 'DELETE'
        });
        
        const data = await response.json();
        if (data.msg === 'success') {
          fetchTasks();
        }
      } catch (error) {
        console.error('åˆ é™¤ä»»åŠ¡å¤±è´¥:', error);
      }
    }

    // é¡µé¢åŠ è½½æ—¶è·å–ä»»åŠ¡åˆ—è¡¨
    fetchTasks();
  </script>
</body>
</html>
```

---

## ğŸ”§ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç 

| çŠ¶æ€ç  | è¯´æ˜ | å¤„ç†å»ºè®® |
|--------|------|----------|
| 200 | è¯·æ±‚æˆåŠŸ | æ­£å¸¸å¤„ç†å“åº”æ•°æ® |
| 201 | åˆ›å»ºæˆåŠŸ | ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼Œè·å–è¿”å›çš„ä»»åŠ¡æ•°æ® |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•°ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º |
| 404 | èµ„æºä¸å­˜åœ¨ | ä»»åŠ¡ä¸å­˜åœ¨ï¼Œæç¤ºç”¨æˆ· |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æç¤ºç”¨æˆ·ç¨åé‡è¯• |

### é”™è¯¯å¤„ç†ç¤ºä¾‹

```javascript
async function handleApiCall(apiFunction) {
  try {
    const response = await apiFunction();
    return { success: true, data: response.data };
  } catch (error) {
    if (error.response) {
      // æœåŠ¡å™¨è¿”å›äº†é”™è¯¯å“åº”
      switch (error.response.status) {
        case 400:
          return { success: false, message: 'è¯·æ±‚å‚æ•°é”™è¯¯' };
        case 404:
          return { success: false, message: 'ä»»åŠ¡ä¸å­˜åœ¨' };
        case 500:
          return { success: false, message: 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•' };
        default:
          return { success: false, message: 'æœªçŸ¥é”™è¯¯' };
      }
    } else if (error.request) {
      // è¯·æ±‚å·²å‘å‡ºä½†æ²¡æœ‰æ”¶åˆ°å“åº”
      return { success: false, message: 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥' };
    } else {
      // å…¶ä»–é”™è¯¯
      return { success: false, message: error.message };
    }
  }
}
```

---

## ğŸŒ è·¨åŸŸé…ç½®

åç«¯å·²é…ç½® CORSï¼Œå…è®¸è·¨åŸŸè¯·æ±‚ã€‚å¦‚æœå‰ç«¯ä»ç„¶é‡åˆ°è·¨åŸŸé—®é¢˜ï¼Œè¯·ç¡®ä¿ï¼š

1. Flask åº”ç”¨å·²å®‰è£…å¹¶å¯ç”¨ `flask-cors`
2. å‰ç«¯è¯·æ±‚çš„ URL æ­£ç¡®
3. æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æ£€æŸ¥ç½‘ç»œè¯·æ±‚è¯¦æƒ…

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ—¶é—´æ ¼å¼**: æ‰€æœ‰æ—¶é—´å­—æ®µä½¿ç”¨ ISO 8601 æ ¼å¼ï¼ˆå¦‚ï¼š`2025-11-24T10:30:00.123456`ï¼‰
2. **å­—ç¬¦ç¼–ç **: æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½ä½¿ç”¨ UTF-8 ç¼–ç 
3. **ç©ºå€¼å¤„ç†**: `description` å­—æ®µå¯èƒ½ä¸º `null`ï¼Œå‰ç«¯éœ€è¦åšç©ºå€¼åˆ¤æ–­
4. **ID ç±»å‹**: ä»»åŠ¡ ID ä¸ºæ•´æ•°ç±»å‹
5. **çŠ¶æ€å­—æ®µ**: å½“å‰ç‰ˆæœ¬ `status` å­—æ®µé»˜è®¤ä¸º `pending`ï¼Œåç»­å¯æ‰©å±•ä»»åŠ¡çŠ¶æ€æ›´æ–°åŠŸèƒ½

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å¯åŠ¨åç«¯æœåŠ¡**
```bash
cd feedback_app
python app.py
```

2. **æµ‹è¯•æ¥å£**
```bash
# ä½¿ç”¨ curl æµ‹è¯•
curl http://localhost:5000/api/tasks
```

3. **å¼€å§‹å‰ç«¯å¼€å‘**
   - å¤åˆ¶ä¸Šé¢çš„ç¤ºä¾‹ä»£ç 
   - æ ¹æ®ä½ çš„å‰ç«¯æ¡†æ¶è¿›è¡Œè°ƒæ•´
   - å¼€å§‹å¼€å‘ï¼

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- åç«¯æ—¥å¿—è¾“å‡º
- æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network æ ‡ç­¾
- Console ä¸­çš„é”™è¯¯ä¿¡æ¯

